WITH date_range AS (
    SELECT generate_series(
        (SELECT MIN("ImportDate")::date FROM pilothouse.wasabi_infora02_reporting),
        (SELECT MAX("ImportDate")::date FROM pilothouse.wasabi_infora02_reporting),
        interval '1 day'
    )::date AS "Date"
),
subclusters AS (
    SELECT DISTINCT COALESCE(as2."name", 'Unknown SubCluster') AS "SubClusterName"
    FROM pilothouse.wasabi_infora02_reporting wir
    LEFT JOIN pilothouse.apm_application_daps aad
        ON wir."APPLICATION_BAM_VALUE" = aad.goldenapp_auid
    LEFT JOIN pilothouse.apm_applications aa
        ON aa.id = aad.apm_application
    LEFT JOIN pilothouse.apm_subclusters as2
        ON aa.apm_subcluster = as2.id
)
SELECT
    d."Date",
    s."SubClusterName",
    COUNT(wir."PAM_LOGINNAME") AS "Count"
FROM date_range d
CROSS JOIN subclusters s
LEFT JOIN pilothouse.wasabi_infora02_reporting wir
    ON wir."ImportDate"::date = d."Date"
LEFT JOIN pilothouse.apm_application_daps aad
    ON wir."APPLICATION_BAM_VALUE" = aad.goldenapp_auid
LEFT JOIN pilothouse.apm_applications aa
    ON aa.id = aad.apm_application
LEFT JOIN pilothouse.apm_subclusters as2
    ON aa.apm_subcluster = as2.id
WHERE COALESCE(as2."name", 'Unknown SubCluster') = s."SubClusterName"
GROUP BY d."Date", s."SubClusterName"
ORDER BY d."Date", s."SubClusterName";





............



SELECT 
    "APM SubCluster" as subcluster,
    COUNT(DISTINCT PAM_LOGINNAME) as account_count
FROM your_table_name
WHERE PAM_LOGINNAME IS NOT NULL 
  AND PAM_LOGINNAME != ''
  AND "APM SubCluster" IS NOT NULL
GROUP BY "APM SubCluster"
ORDER BY account_count DESC;
